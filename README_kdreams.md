# Kドリームス競輪スクレイピングアプリ

Streamlitを使用した競輪データ取得Webアプリケーション

## 機能

### レース個別取得
- 📋 当日のS級レース一覧取得
- 🏁 出走表データ（19カラム）の取得
- 💰 オッズ（人気順50通り）の取得
- 🏆 レース結果の取得
- 📥 CSV形式でのダウンロード/コピー

### 開催場一括取得 ⭐NEW
- 📦 開催場の全レース（1R〜12R）を一括取得
- 📊 出走表、オッズ、結果を1つのExcelファイルに統合（複数シート）
- ⚡ 開催場ごとに1ファイルで管理可能
- 💯 文字化けなし（Excel形式）

## インストール

```bash
# 依存パッケージのインストール
pip install -r requirements.txt
```

## 使い方

```bash
# アプリの起動
streamlit run kdreams_app.py
```

ブラウザで自動的に開きます（通常 http://localhost:8501）

### 操作手順

#### 方法1: レース個別取得（20〜30秒）
1. **レース一覧を取得**: サイドバーの「本日の開催場一覧を取得」ボタンをクリック
2. **開催場選択**: ステップ1で開催場を選択
3. **レース選択**: ステップ2でレース（1R〜12R）を選択
4. **データ取得**: 「データを取得」ボタンをクリック
5. **CSVダウンロード**: 各タブのダウンロードボタンまたはコピーボタンでデータを取得

#### 方法2: 開催場一括取得（2〜3分）
1. **レース一覧を取得**: サイドバーの「本日の開催場一覧を取得」ボタンをクリック
2. **開催場選択**: ステップ1で開催場を選択
3. **一括取得**: 「📦 この開催場の全レースを一括取得」ボタンをクリック
4. **Excelダウンロード**: 「📊 Excelファイルをダウンロード」ボタンで1つのExcelファイル（3シート構成）を取得

## データ項目

### 出走表（19カラム）
```
車番, 選手名, 府県, 年齢, 期別, 級班, 脚質, ギヤ倍数, 競走得点, S, B, 逃, 捲, 差, マ, 1着, 2着, 3着, 着外
```

### オッズ（人気順）
人気順の3連単オッズ50通り
```
順位, 組み合わせ, オッズ
```

### レース結果
```
着順, 車番, 選手名, 着差, 上がり, 決まり手, S/B
```

### 一括取得時のExcelファイル構成
ダウンロードされるExcelファイル（.xlsx）には3つのシートが含まれます:
- **「出走表」シート**: 全レースの出走表データ（レース列付き）
- **「オッズ」シート**: 全レースのオッズデータ（レース列付き）
- **「レース結果」シート**: 全レースの結果データ（レース列付き）

各シートの各行に「レース」列が追加されます（例: "1R", "2R", ...）

## 注意事項

- ⚠️ Kドリームスのサイト構造変更により動作しない場合があります
- ⚠️ 過度なアクセスはサーバーに負荷をかけるため、適度な間隔で使用してください
- ⚠️ スクレイピングは利用規約を確認の上、自己責任で行ってください

## ファイル構成

```
├── kdreams_app.py             # Streamlitアプリ本体
├── kdreams_scraper.py         # スクレイピングロジック
├── requirements_kdreams.txt   # 依存パッケージ
└── README_kdreams.md         # このファイル
```

## トラブルシューティング

### データが取得できない場合

1. Kドリームスのサイトにブラウザでアクセスできるか確認
2. `kdreams_scraper.py` のセレクタがサイト構造と一致しているか確認
3. エラーメッセージを確認し、該当箇所を修正

### 実際のHTML構造に合わせた調整方法

`kdreams_scraper.py` の各メソッドで、BeautifulSoupのセレクタを実際のHTML構造に合わせて調整してください。

例:
```python
# クラス名で検索
table = soup.find('table', class_='race-table')

# IDで検索
table = soup.find('table', id='race-card')

# 複数条件
table = soup.find('table', {'class': 'table', 'data-type': 'racecard'})
```
